<!DOCTYPE html>
<html>
<head>
  <title>Transform</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
  <script src="holy-diver.js"></script>
  <script>
    $(function(){
      
      // Start a web server
      // python -m SimpleHTTPServer
      // -------------------------------
      
      
      // Keen IO Sample #1
      // -------------------------------
      
      $.getJSON("http://localhost:8000/sample-data/keen.json", function(data) {
        
        var keen = new flatten(data.result, {
          cols: {
            label: 'Date',
            cells: 'value -> page'
          },
          rows: {
            index: 'timeframe -> start',
            cells: 'value -> result -> number -> value'
          }
        });
        
        console.log('Keen IO raw response', keen.raw);
        console.log('Keen IO as table', keen.table);
        console.log('Keen IO as series', keen.series);
        console.log('------------------');
      });
      
      
      // Keen IO Sample #2
      // -------------------------------
      
      $.getJSON("http://localhost:8000/sample-data/keen2.json", function(data) {
        
        window.keen2 = new flatten(data.result, {
          cols: {
            label: 'Date',
            cells: 'value -> parsed_user_agent.os.family'
          },
          rows: {
            index: 'timeframe -> start',
            cells: 'value -> result',
            transform: {
              0: function(value){
                return new Date(value).getUTCMonth() + "/" + new Date(value).getUTCFullYear();
              }
            }
          }
        });
        
        console.log('Keen IO #2 raw response', window.keen2.raw);
        console.log('Keen IO #2 as table', window.keen2.table);
        console.log('Keen IO #2 as series', window.keen2.series);
        console.log('------------------');
      });
      
      // Twitter Sample
      // -------------------------------
      
      $.getJSON("http://localhost:8000/sample-data/twitter.json", function(data) {
        
        window.tweets = new flatten(data, {
          cols: {
            label: 'Date',
            cells: 'user -> screen_name'
          },
          rows: {
            index: 'created_at',
            cells: 'text',
            transform: {
              0: function(value){
                var date = new Date(Date.parse(value.replace(/( +)/, ' UTC$1')));
                return date.getUTCMonth() + "/" + date.getUTCFullYear();
              }
            }
          }
        });
				
        console.log('Tweets raw response', window.tweets.raw);
        console.log('Tweets as table', window.tweets.table);
        console.log('Tweets as series', window.tweets.series);
        console.log('------------------');
				
				/*
				var mixed = window.keen2.append(tweets, 1, function(prev, value){
					console.log(prev, value);
					return (prev == void 0) ? [value] : prev.push(value);
				});
				console.log(mixed.render('csv'));*/

      });
      
    });
  </script>
</head>
<body>
  
</body>
</html>